/**
 * Flagity v1.0.0-beta
 *
 * Custom binding for knockoutjs to switch boolean attibutes of the DOM with flags
 *
 * Copyright(c) 2013 Delmo Carrozzo <dcardev@gmail.com>
 * MIT Licensed
 *
 * project https://github.com/delmosaurio/flagity
 * issues https://github.com/delmosaurio/flagity/issues
 *
 */
!function($,ko,undefined){ko.flagity=ko.flagity||{},ko.flagity.Flagity=function(ko){function keysWraper(keys){var res=[];return keys!==undefined&&(res=keys.split(",")),res}function binaryComparer(flags,value){return(flags&value)==flags}function keysComparer(key,flags){for(var f,keys=keysWraper(flags);keys.length;)if(f=keys.shift(),f==key)return!0;return!1}var Flagity=function(options,valueAccessor){var self=this;if(options=options||{},self.type=options.type||"binary",self.flag=valueAccessor,options.comparer!==undefined){if("function"!=typeof options.comparer)return new Error("the comparer is not a function");self.comparer=options.comparer}else"keys"==self.type&&(self.comparer=keysComparer);return self};return Flagity.prototype.comparer=binaryComparer,Flagity.prototype.match=function(flags,fComparer){return fComparer!==undefined&&"function"==typeof fComparer?fComparer.apply(this,[flags,ko.unwrap(this.flag),this.type]):this.comparer.apply(this,[flags,ko.unwrap(this.flag),this.type])},Flagity}(ko),ko.bindingHandlers.flagityWith={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var newProperties={_flagity:new ko.flagity.Flagity(allBindingsAccessor().flagityOptions,valueAccessor())},childBindingContext=bindingContext.createChildContext(viewModel);return ko.utils.extend(childBindingContext,newProperties),ko.applyBindingsToDescendants(childBindingContext,element),{controlsDescendantBindings:!0}}},ko.bindingHandlers.flagity={update:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var flagityOptions=ko.unwrap(valueAccessor()),_f=bindingContext._flagity,fComparer=undefined;return _f===undefined&&flagityOptions.flag===undefined?new Error("flagity","something wrong, no flag and no flagityWith defined"):(_f===undefined&&(_f=new ko.flagity.Flagity(flagityOptions,flagityOptions.flag)),flagityOptions.hasOwnProperty("comparer")&&(fComparer=flagityOptions.comparer),"object"==typeof flagityOptions&&ko.utils.objectForEach(flagityOptions,function(propName,value){ko.bindingHandlers.hasOwnProperty(propName)&&("object"==typeof value?ko.utils.objectForEach(value,function(attrName,objValue){var to=[];to[attrName]=_f.match(ko.unwrap(objValue),fComparer),ko.bindingHandlers[propName].update(element,function(){return to})}):ko.bindingHandlers[propName].update(element,function(){return _f.match(ko.unwrap(value),fComparer)}))}),void 0)}}}(jQuery,ko);